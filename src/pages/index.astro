---
import type { SanityDocument } from "@sanity/client";
import { sanityClient } from "sanity:client";
import LatestItemsSection from "@/components/LatestItemsSection.astro";
import Link from "@/components/Link.astro";
import SocialLinks from "@/components/SocialLinks.astro";
import Layout from "@/layouts/Layout.astro";

const LATEST_POSTS_QUERY = `*[
  _type == "post"
  && defined(slug.current)
]|order(publishedAt desc)[0...3]{_id, title, slug, publishedAt}`;

const LATEST_PROJECTS_QUERY = `*[
  _type == "project"
  && defined(slug.current)
]|order(publishedAt desc)[0...3]{_id, title, slug, publishedAt, techStack}`;

const LATEST_APPEARANCES_QUERY = `*[
  _type == "appearance"
  && defined(slug.current)
]|order(publishedAt desc)[0...3]{_id, title, slug, publishedAt}`;

const latestPosts =
  await sanityClient.fetch<SanityDocument[]>(LATEST_POSTS_QUERY);

const latestProjects = await sanityClient.fetch<SanityDocument[]>(
  LATEST_PROJECTS_QUERY,
);

const latestAppearances = await sanityClient.fetch<SanityDocument[]>(
  LATEST_APPEARANCES_QUERY,
);
---

<Layout>
  <main class="space-y-16">
    <section class="space-y-8 md:px-2">
      <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight text-foreground sm:text-5xl">
          Ryan Furrer
        </h1>
        <p class="font-serif italic text-xl text-foreground-muted sm:text-2xl">
          Frontend Engineer & Designer
        </p>
      </div>
      <div class="space-y-3 font-medium">
        <p>
          Currently a Design Engineer at <a href="https://pragma.gg">Pragma</a>,
          building <a href="https://firstlook.gg">FirstLook</a> — the platform
          helping game studios build and engage their communities.
        </p>
        <p class="text-foreground-muted font-normal">
          I care deeply about the intersection of design and engineering — where
          performance, accessibility, and craft come together.
        </p>
        <Link href="/about">More about me</Link>
      </div>

      <div class="space-y-2">
        <p class="small-heading text-rf-accent">Find me elsewhere</p>
        <div class="text-sm">
          <SocialLinks orientation="horizontal" />
        </div>
      </div>
    </section>
    <LatestItemsSection
      title="Writing"
      items={latestPosts}
      basePath="/writing"
    />
    <LatestItemsSection title="Work" items={latestProjects} basePath="/work" />
    <LatestItemsSection
      title="Appearances"
      items={latestAppearances}
      basePath="/appearances"
    />
  </main>
</Layout>
