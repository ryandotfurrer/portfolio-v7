---
import type { SanityDocument } from "@sanity/client";
import { sanityClient } from "sanity:client";
import LatestItemsSection from "@/components/LatestItemsSection.astro";
import Link from "@/components/Link.astro";
import SocialLinks from "@/components/SocialLinks.astro";
import Layout from "@/layouts/Layout.astro";

const LATEST_POSTS_QUERY = `*[
  _type == "post"
  && defined(slug.current)
]|order(publishedAt desc)[0...3]{_id, title, slug, publishedAt}`;

const LATEST_PROJECTS_QUERY = `*[
  _type == "project"
  && defined(slug.current)
]|order(publishedAt desc)[0...3]{_id, title, slug, publishedAt, techStack}`;

const LATEST_APPEARANCES_QUERY = `*[
  _type == "appearance"
  && defined(slug.current)
]|order(publishedAt desc)[0...3]{_id, title, slug, publishedAt}`;

const latestPosts =
  await sanityClient.fetch<SanityDocument[]>(LATEST_POSTS_QUERY);

const latestProjects = await sanityClient.fetch<SanityDocument[]>(
  LATEST_PROJECTS_QUERY,
);

const latestAppearances = await sanityClient.fetch<SanityDocument[]>(
  LATEST_APPEARANCES_QUERY,
);
---

<Layout>
  <div class="space-y-16">
    <header class="space-y-4 md:px-2">
      <div class="space-y-2">
        <h1 class="font-medium text-primary">Ryan Furrer</h1>
        <p class="text-lg/5 font-medium text-pretty">
          <span class="text-foreground">Frontend Engineer</span> who loves creating
          where design and engineering meet.
        </p>
      </div>
      <div class="mb-6 space-y-2 font-medium">
        <p>
          Currently I am a Design Engineer at <a href="https://pragma.gg"
            >Pragma</a
          >, part of the team creating the platform that helps studios build
          successful games, <a href="https://firstlook.gg">FirstLook</a>.
        </p>
        <Link href="/about">Learn more about me</Link>
      </div>

      <div class="space-y-2">
        <span class="small-heading inline-block">Find me elsewhere:</span>
        <div class="text-sm">
          <SocialLinks orientation="horizontal" />
        </div>
      </div>
    </header>
  </div>
  <main class="space-y-16">
    <LatestItemsSection
      title="Writing"
      items={latestPosts}
      basePath="/writing"
    />
    <LatestItemsSection title="Work" items={latestProjects} basePath="/work" />
    <LatestItemsSection
      title="Appearances"
      items={latestAppearances}
      basePath="/appearances"
    />
  </main>
</Layout>
